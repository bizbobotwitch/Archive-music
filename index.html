<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Archive Music</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body class="bg-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Simple Icons using SVG to avoid external dependency issues on GitHub
        const IconPlay = () => <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>;
        const IconPause = () => <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>;
        const IconNext = () => <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>;
        const IconPrev = () => <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>;
        const IconSearch = () => <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>;

        const App = () => {
            const [view, setView] = useState('home');
            const [query, setQuery] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [currentTrack, setCurrentTrack] = useState(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [progress, setProgress] = useState(0);
            const audioRef = useRef(null);

            // GitHub Pages specific: Ensure we load something immediately
            useEffect(() => {
                searchArchive('Lo-Fi');
            }, []);

            const searchArchive = async (q) => {
                if (!q) return;
                setLoading(true);
                try {
                    const response = await fetch(`https://archive.org/advancedsearch.php?q=mediatype:audio AND ${q}&output=json&rows=24&page=1&sort[]=downloads+desc`);
                    const data = await response.json();
                    const docs = data?.response?.docs || [];
                    setResults(docs.map(d => ({
                        id: d.identifier,
                        title: d.title || 'Unknown Title',
                        creator: d.creator || 'Archive Artist',
                        img: `https://archive.org/services/img/${d.identifier}`
                    })));
                } catch (e) {
                    console.error("Fetch failed");
                } finally {
                    setLoading(false);
                }
            };

            const playItem = async (item) => {
                setLoading(true);
                try {
                    const res = await fetch(`https://archive.org/metadata/${item.id}`);
                    const data = await res.json();
                    const file = data.files.find(f => f.name.endsWith('.mp3'));
                    if (file) {
                        const url = `https://archive.org/download/${item.id}/${encodeURIComponent(file.name)}`;
                        setCurrentTrack({ ...item, url });
                        setIsPlaying(true);
                    }
                } catch (e) {
                    alert("Could not load this track.");
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                if (!audioRef.current || !currentTrack) return;
                if (isPlaying) audioRef.current.play().catch(() => setIsPlaying(false));
                else audioRef.current.pause();
            }, [isPlaying, currentTrack]);

            return (
                <div className="fixed inset-0 flex flex-col bg-white overflow-hidden">
                    {/* Header */}
                    <header className="p-4 border-b flex items-center justify-between shrink-0">
                        <div className="flex items-center space-x-2">
                            <div className="w-8 h-8 bg-black rounded flex items-center justify-center text-white">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                            </div>
                            <h1 className="font-black text-xl tracking-tighter uppercase">Archive</h1>
                        </div>
                        <div className="relative w-1/2 max-w-xs">
                            <input 
                                type="text" 
                                placeholder="Search..." 
                                className="w-full bg-gray-100 rounded-full py-2 px-4 pl-10 text-sm focus:outline-none"
                                value={query}
                                onChange={e => setQuery(e.target.value)}
                                onKeyDown={e => e.key === 'Enter' && searchArchive(query)}
                            />
                            <div className="absolute left-3 top-2.5 text-gray-400">
                                <IconSearch />
                            </div>
                        </div>
                    </header>

                    {/* Content */}
                    <main className="flex-1 overflow-y-auto p-4 no-scrollbar">
                        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 pb-32">
                            {results.map(item => (
                                <div key={item.id} onClick={() => playItem(item)} className="cursor-pointer group">
                                    <div className="aspect-square bg-gray-200 rounded-2xl overflow-hidden relative mb-2">
                                        <img src={item.img} className="w-full h-full object-cover group-hover:scale-105 transition-transform" />
                                        <div className="absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                            <div className="bg-white p-3 rounded-full shadow-xl"><IconPlay /></div>
                                        </div>
                                    </div>
                                    <p className="font-bold text-xs truncate">{item.title}</p>
                                    <p className="text-gray-400 text-[10px] uppercase font-bold truncate">{item.creator}</p>
                                </div>
                            ))}
                        </div>
                        {loading && (
                            <div className="fixed inset-0 bg-white/80 flex flex-col items-center justify-center z-50">
                                <div className="w-10 h-10 border-4 border-black border-t-transparent rounded-full animate-spin"></div>
                                <p className="mt-4 font-black uppercase text-xs tracking-widest">Loading...</p>
                            </div>
                        )}
                        {results.length === 0 && !loading && (
                            <div className="flex flex-col items-center justify-center h-64 text-center">
                                <p className="font-black text-gray-200 text-4xl mb-4">NO DATA</p>
                                <button onClick={() => searchArchive('Popular')} className="bg-black text-white px-6 py-2 rounded-full font-bold text-sm">Emergency Refresh</button>
                            </div>
                        )}
                    </main>

                    {/* Player */}
                    {currentTrack && (
                        <div className="h-24 bg-white border-t p-4 flex items-center justify-between shrink-0 z-50">
                            <div className="flex items-center space-x-3 w-1/3 min-w-0">
                                <img src={currentTrack.img} className="w-12 h-12 rounded-lg shadow-md shrink-0" />
                                <div className="min-w-0">
                                    <p className="font-bold text-sm truncate">{currentTrack.title}</p>
                                    <p className="text-gray-400 text-[10px] font-black uppercase truncate">{currentTrack.creator}</p>
                                </div>
                            </div>
                            <div className="flex flex-col items-center w-1/3">
                                <div className="flex items-center space-x-6">
                                    <button className="text-gray-400"><IconPrev /></button>
                                    <button onClick={() => setIsPlaying(!isPlaying)} className="w-12 h-12 bg-black text-white rounded-full flex items-center justify-center shadow-lg">
                                        {isPlaying ? <IconPause /> : <IconPlay />}
                                    </button>
                                    <button className="text-gray-400"><IconNext /></button>
                                </div>
                            </div>
                            <div className="w-1/3 flex justify-end">
                                <div className="hidden md:block w-32 h-1 bg-gray-100 rounded-full relative">
                                    <div className="absolute inset-y-0 left-0 bg-black rounded-full" style={{width: '70%'}}></div>
                                </div>
                            </div>
                            <audio 
                                ref={audioRef} 
                                src={currentTrack.url} 
                                onTimeUpdate={() => setProgress((audioRef.current.currentTime / audioRef.current.duration) * 100)}
                                onEnded={() => setIsPlaying(false)}
                            />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
